var formidable = require('formidable');var fs = require('fs');var path = require('path');var moment = require('moment');module.exports = function (app) {  app.get('/api/upload/:file_id', function(req, res){    res.sendFile(path.join(__dirname, '../uploads/' + req.params.file_id));  });  app.post('/api/upload', function(req, res){    var uri;    // create an incoming form object    var form = new formidable.IncomingForm();    // specify that we want to allow the user to upload multiple files in a single request    form.multiples = true;    // store all uploads in the /uploads directory    form.uploadDir = path.join(__dirname, '../uploads');    // every time a file has been uploaded successfully,    // rename it to it's orignal name    form.on('file', function(field, file) {      var uniqueUri = moment().unix() + '_' + Math.random().toString(36);      fs.rename(file.path, path.join(form.uploadDir, uniqueUri));      uri = uniqueUri;    });    // log any errors that occur    form.on('error', function(err) {      console.log('An error has occured: \n' + err);    });    // once all the files have been uploaded, send a response to the client    form.on('end', function() {      console.log(uri);      res.end(uri);    });    // parse the incoming request containing the form data    form.parse(req);  });}